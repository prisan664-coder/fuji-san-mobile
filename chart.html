<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Charts - Fuji Mobile Shop</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background: #f8f9fa;
        }

        .card-chart {
            border-radius: 12px;
            box-shadow: 0 6px 18px rgba(20, 20, 50, 0.06);
            padding: 20px;
            margin-top: 20px;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
        <div class="container">
            <a class="navbar-brand" href="index.html">Fuji Mobile Shop</a>
            <div class="ms-auto">
                <a class="btn btn-outline-secondary" href="summary.html">Summary</a>
            </div>
        </div>
    </nav>

    <div class="container py-4">
        <div class="card-chart">
            <h4>กราฟยอดขายรายวัน</h4>
            <canvas id="dailyChart"></canvas>
        </div>
        <div class="card-chart">
            <h4 class="mt-4">กราฟยอดขายรายเดือน</h4>
            <canvas id="monthlyChart"></canvas>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
        import { getDatabase, ref, onValue } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js';

        const firebaseConfig = {
            apiKey: "",
            authDomain: "",
            projectId: "",
            storageBucket: "",
            messagingSenderId: "",
            appId: "",
            databaseURL: "https://fuji-mobile-shop-default-rtdb.asia-southeast1.firebasedatabase.app/"
        };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const salesRef = ref(db, 'sales');

        onValue(salesRef, (snapshot) => {
            const data = snapshot.val() || {};
            const daily = {};
            const monthly = {};

            Object.values(data).forEach(s => {
                const date = s.date;
                const month = date.slice(0, 7);
                const total = (Number(s.price) || 0) * (Number(s.qty) || 0);
                daily[date] = (daily[date] || 0) + total;
                monthly[month] = (monthly[month] || 0) + total;
            });

            renderChart('dailyChart', Object.keys(daily), Object.values(daily), 'ยอดขายรายวัน (Kip)');
            renderChart('monthlyChart', Object.keys(monthly), Object.values(monthly), 'ยอดขายรายเดือน (Kip)');
        });

        function renderChart(id, labels, data, label) {
            const ctx = document.getElementById(id).getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: label,
                        data: data,
                        backgroundColor: 'rgba(54, 162, 235, 0.6)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>