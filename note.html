<!DOCTYPE html>
<html lang="lo">

<head>
    <meta charset="UTF-8">
    <title>‡∫•‡∫∞‡∫ö‡∫ª‡∫ö‡∫ö‡∫±‡∫ô‡∫ó‡∫∂‡∫Å‡∫•‡∫≤‡∫ç‡∫à‡ªà‡∫≤‡∫ç</title>
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
            background: #f7f7f7;
        }

        .navbar {
            background: #333;
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .navbar a {
            color: white;
            text-decoration: none;
            font-size: 19px;
            padding: 8px 12px;
            display: inline-block;
        }

        input,
        button {
            padding: 10px;
            margin: 5px;
        }

        /* üî• MODIFIED: ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°‡∏ï‡∏≤‡∏°‡∏†‡∏≤‡∏û */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 4px;
            overflow: hidden;
            /* **‡∏•‡∏ö‡πÄ‡∏™‡πâ‡∏ô‡∏Ç‡∏≠‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á (border: none;)** */
            border: none;
        }

        th {
            background: #4CAF50;
            /* ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
            color: white;
            font-weight: 500;
            text-transform: none;
            padding: 10px 8px;
            /* ‡πÉ‡∏™‡πà padding ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö header */
            border: 1px solid #4CAF50;
            /* ‡πÉ‡∏´‡πâ header ‡∏°‡∏µ‡πÄ‡∏™‡πâ‡∏ô‡πÅ‡∏ö‡πà‡∏á‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
        }

        td {
            border-top: 1px solid #e0e0e0;
            /* ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏™‡πâ‡∏ô‡πÅ‡∏ö‡πà‡∏á‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô (Top Border) */
            border-left: none;
            border-right: none;
            /* **‡∏•‡∏ö‡πÄ‡∏™‡πâ‡∏ô‡πÅ‡∏ö‡πà‡∏á‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á** */
            padding: 10px 8px;
            text-align: center;
        }

        /* üî• NEW/MODIFIED: ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏ï‡∏≤‡∏°‡∏†‡∏≤‡∏û */
        #expenseTable td:nth-child(1) {
            /* ‡∏•‡∏≥‡∏î‡∏±‡∏ö (‡∫•‡∫≥‡∫î‡∫±‡∫ö) */
            width: 5%;
            min-width: 40px;
            font-weight: normal;
            color: #333;
            text-align: center;
        }

        #expenseTable td:nth-child(2) {
            /* ‡∫ß‡∫±‡∫ô‡∫ó‡∫µ (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà) */
            width: 15%;
            min-width: 100px;
            text-align: center;
        }

        #expenseTable td:nth-child(3) {
            /* ‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô (‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£) */
            text-align: left;
            padding-left: 10px;
            width: 40%;
            min-width: 150px;
        }

        #expenseTable td:nth-child(4) {
            /* ‡∫•‡∫≤‡∫Ñ‡∫≤ (‡∏£‡∏≤‡∏Ñ‡∏≤) - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏≠‡πà‡∏≠‡∏ô‡πÜ ‡πÅ‡∏•‡∏∞‡πÄ‡∏ô‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏¥‡∏î‡∏Ç‡∏ß‡∏≤*/
            text-align: right;
            padding-right: 15px;
            width: 15%;
            min-width: 90px;
            font-weight: bold;
            color: #d9534f;
            background-color: #ffeaea;
            /* ‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π‡∏≠‡πà‡∏≠‡∏ô‡∏°‡∏≤‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏Æ‡πÑ‡∏•‡∏ï‡πå‡∏£‡∏≤‡∏Ñ‡∏≤ */
        }

        /* ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡∏•‡∏ö */
        #expenseTable td:nth-child(5),
        #expenseTable td:nth-child(6) {
            width: 10%;
            min-width: 50px;
        }

        /* üî• NEW: ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡∏∞‡∏•‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°‡πÄ‡∏•‡πá‡∏Å‡πÜ ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô‡∏†‡∏≤‡∏û */
        #expenseTable button {
            background-color: white;
            color: #333;
            border: 1px solid #ccc;
            padding: 5px 8px;
            /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏•‡πá‡∏Å‡∏•‡∏á */
            border-radius: 2px;
            /* ‡∏Ç‡∏≠‡∏ö‡∏°‡∏ô‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ */
            cursor: pointer;
            width: 30px;
            height: 30px;
            line-height: 1;
            /* ‡∏à‡∏±‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á */
            box-shadow: 0 1px 1px rgba(0, 0, 0, 0.05);
            font-size: 14px;
        }

        .summary {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 5px;
        }

        #editBox,
        #deleteConfirmBox {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, .5);
            display: none;
            justify-content: center;
            align-items: center;
        }

        #editContent,
        #deleteContent {
            background: #fff;
            padding: 20px;
            width: 300px;
            border-radius: 8px;
        }

        #deleteContent button {
            width: 45%;
        }

        /* Style ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Notification (‡∏à‡∏≥‡∏•‡∏≠‡∏á) */
        .notification {
            position: fixed;
            top: 10px;
            right: 10px;
            background-color: #5cb85c;
            color: white;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            display: none;
            /* ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ */
            transition: opacity 0.5s;
            max-width: 300px;
        }

        .daily-reminder {
            background-color: #f0ad4e;
            /* ‡∏™‡∏µ‡∏™‡πâ‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ï‡∏≠‡∏ô‡πÄ‡∏ä‡πâ‡∏≤ */
        }

        .save-complete {
            background-color: #5cb85c;
            /* ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å */
        }

        /* Custom Alert Modal Style (‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°) */
        #customAlertBox {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, .6);
            display: none;
            /* ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÅ‡∏£‡∏Å */
            justify-content: center;
            align-items: center;
            z-index: 2000;
            /* ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á */
            backdrop-filter: blur(2px);
            /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° */
        }

        #customAlertContent {
            background: #fff;
            padding: 30px;
            width: 300px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            text-align: center;
            animation: fadeIn 0.3s ease-out;
            /* ‡πÄ‡∏û‡∏¥‡πà‡∏° Animation */
        }

        #customAlertContent p {
            font-size: 16px;
            margin-bottom: 20px;
            color: #333;
            font-weight: bold;
        }

        #customAlertContent button {
            background: #28a745;
            /* ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏° OK ‡πÉ‡∏ô‡∏†‡∏≤‡∏û */
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.2s;
        }

        #customAlertContent button:hover {
            background: #1e7e34;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }
    </style>
</head>

<body>
    <div class="navbar"> <a href="index.html">üè† ‡∫Å‡∫±‡∫ö‡ªú‡ªâ‡∫≤‡∫´‡∫º‡∫±‡∫Å</a> <a href="docu-note.html">‡∫ö‡∫±‡∫ô‡∫ó‡∫∂‡∫Å‡ªÄ‡∫•‡∫∑‡ªà‡∫≠‡∫á‡∫•‡∫≤‡∫ß</a> </div>
    <h2>üí∞ ‡∫•‡∫∞‡∫ö‡∫ª‡∫ö‡∫ö‡∫±‡∫ô‡∫ó‡∫∂‡∫Å‡∫•‡∫≤‡∫ç‡∫à‡ªà‡∫≤‡∫ç‡∫õ‡∫∞‡∫à‡∫≥‡∫ß‡∫±‡∫ô</h2>
    <label>‡∫ß‡∫±‡∫ô‡∫ó‡∫µ:</label> <input type="date" id="dateInput"><br>
    <label>‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô:</label> <input type="text" id="itemInput" placeholder="‡∫ä‡∫∑‡ªâ‡∫´‡∫ç‡∫±‡∫á?"><br>
    <label>‡∫•‡∫≤‡∫Ñ‡∫≤:</label> <input type="number" id="priceInput" placeholder="0"><br>
    <button onclick="saveExpense()">‚ûï ‡∫ö‡∫±‡∫ô‡∫ó‡∫∂‡∫Å‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô</button>
    <hr>
    <label>‡ªÄ‡∫•‡∫∑‡∫≠‡∫Å‡ªÄ‡∫î‡∫∑‡∫≠‡∫ô:</label> <select id="monthSelect" onchange="loadMonth()"></select>
    <div class="summary">
        <h3>üìä ‡∫™‡∫∞‡∫´‡∫º‡∫∏‡∫ö‡∫•‡∫≤‡∫ç‡∫à‡ªà‡∫≤‡∫ç‡ªÄ‡∫î‡∫∑‡∫≠‡∫ô</h3>
        <p id="todayTotalText" style="color:#d9534f;font-weight:bold;"></p>
        <p id="totalText">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: 0 ‡∫Å‡∫µ‡∫ö</p>
    </div>
    <button onclick="exportExcel()" style="background:#1f7cff;color:white;border:none;border-radius:5px;"> üì• Export
        Excel </button>
    <table>
        <thead>
            <tr>
                <th>‡∫•‡∫≥‡∫î‡∫±‡∫ö</th>
                <th>‡∫ß‡∫±‡∫ô‡∫ó‡∫µ</th>
                <th>‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô</th>
                <th>‡∫•‡∫≤‡∫Ñ‡∫≤</th>
                <th>‡ªÅ‡∫Å‡ªâ‡ªÑ‡∫Ç</th>
                <th>‡∫•‡∫∂‡∫ö</th>
            </tr>
        </thead>
        <tbody id="expenseTable"></tbody>
    </table>
    <div id="editBox">
        <div id="editContent">
            <h3>‚úè ‡ªÅ‡∫Å‡ªâ‡ªÑ‡∫Ç‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô</h3>
            <label>‡∫ß‡∫±‡∫ô‡∫ó‡∫µ:</label> <input type="date" id="editDate"><br>
            <label>‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô:</label> <input type="text" id="editItem"><br>
            <label>‡∫•‡∫≤‡∫Ñ‡∫≤:</label> <input type="number" id="editPrice"><br>
            <button onclick="saveEdit()">üíæ ‡∫ö‡∫±‡∫ô‡∫ó‡∫∂‡∫Å</button> <button onclick="closeEdit()">‚ùå ‡∫õ‡∫¥‡∫î</button>
        </div>
    </div>
    <div id="deleteConfirmBox">
        <div id="deleteContent">
            <h3 style="color:red;">‚ö† ‡∫¢‡∫∑‡∫ô‡∫¢‡∫±‡∫ô‡∫Å‡∫≤‡∫ô‡∫•‡∫ª‡∫ö</h3>
            <p>‡∫ó‡ªà‡∫≤‡∫ô‡ªÅ‡∫ô‡ªà‡ªÉ‡∫à‡∫ö‡ªç‡∫ß‡ªà‡∫≤‡∫ï‡ªâ‡∫≠‡∫á‡∫Å‡∫≤‡∫ô‡∫•‡∫ª‡∫ö‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô‡∫ô‡∫µ‡ªâ?</p> <button onclick="confirmDelete()"
                style="background:#d9534f;color:white;">‡∫•‡∫ª‡∫ö</button> <button onclick="cancelDelete()">‡∫ç‡∫ª‡∫Å‡ªÄ‡∫•‡∫µ‡∫Å</button>
        </div>
    </div>
    <div id="customAlertBox">
        <div id="customAlertContent">
            <p id="customAlertMessage">‡∫Å‡∫∞‡∫•‡∫∏‡∫ô‡∫≤‡∫Å‡∫≠‡∫Å‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô‡ªÉ‡∫´‡ªâ‡∫Ñ‡∫ª‡∫ö‡∫ñ‡ªâ‡∫ß‡∫ô</p>
            <button onclick="closeCustomAlert()">OK</button>
        </div>
    </div>
    <div id="appNotification" class="notification daily-reminder"></div>
    <script type="module">
        import {
            initializeApp
        } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import {
            getDatabase,
            ref,
            set,
            onValue,
            push,
            remove,
            update,
            get
        } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC8b0h8yyTo5th6UMvI4_dKUB1ZnvCwZBw",
            authDomain: "fuji-mobile-shop.firebaseapp.com",
            databaseURL: "https://fuji-mobile-shop-default-rtdb.asia-southeast1.firebasedatabase.app/",
            projectId: "fuji-mobile-shop",
            storageBucket: "fuji-mobile-shop.appspot.com",
            messagingSenderId: "753053073037",
            appId: "1:753053073037:web:7c9cb46e055b91a4cf2cc4"
        };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const monthSelect = document.getElementById("monthSelect");
        const currentYear = new Date().getFullYear();
        let EDIT_Y = "",
            EDIT_M = "",
            EDIT_KEY = "";
        let DELETE_Y = "",
            DELETE_M = "",
            DELETE_KEY = "";

        // --- üî• NEW: Text-to-Speech Function ---
        function speakText(text) {
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            if ('speechSynthesis' in window) {
                // ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏û‡∏π‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
                window.speechSynthesis.cancel();

                const utterance = new SpeechSynthesisUtterance(text);
                // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏†‡∏≤‡∏©‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ (th-TH) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
                utterance.lang = 'th-TH';

                // ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß (Rate): 1.0 ‡∏Ñ‡∏∑‡∏≠‡∏õ‡∏Å‡∏ï‡∏¥
                utterance.rate = 1.0;

                window.speechSynthesis.speak(utterance);
            } else {
                console.log("Speech Synthesis ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ");
            }
        }

        // Custom Alert Functions
        function showCustomAlert(message) {
            document.getElementById("customAlertMessage").textContent = message;
            document.getElementById("customAlertBox").style.display = "flex";
            // üî• MODIFIED: ‡∏≠‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á Alert ‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
            speakText("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô");
        }

        window.closeCustomAlert = function () {
            document.getElementById("customAlertBox").style.display = "none";
        };

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á Notification (‡∏à‡∏≥‡∏•‡∏≠‡∏á)
        function showNotification(message, type) {
            const notifBox = document.getElementById("appNotification");
            notifBox.textContent = message;
            notifBox.className = `notification ${type}`; // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏µ‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó
            notifBox.style.display = "block";
            notifBox.style.opacity = 1;

            // ‡∏ã‡πà‡∏≠‡∏ô Notification ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
            setTimeout(() => {
                notifBox.style.opacity = 0;
                setTimeout(() => notifBox.style.display = "none", 500); // ‡∏ã‡πà‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å transition ‡πÄ‡∏™‡∏£‡πá‡∏à
            }, 5000);
        }

        // Morning Reminder
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById("dateInput").value = new Date().toISOString().split('T')[0];
            const reminderMsg = "üîî ‡∫ß‡∫±‡∫ô‡∫ô‡∫µ‡ªâ‡∫¢‡ªà‡∫≤‡∫•‡∫∑‡∫°‡∫ö‡∫±‡∫ô‡∫ó‡∫∂‡∫Å‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô‡∫õ‡∫∞‡∫à‡∫≥‡∫ß‡∫±‡∫ô‡∫î‡ªâ‡∫ß‡∫ç‡∫ô‡∫∞";
            showNotification(reminderMsg, "daily-reminder");

            // üî• MODIFIED: ‡∏≠‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ï‡∏≠‡∏ô‡πÄ‡∏ä‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
            speakText("‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö");
        });

        async function loadAvailableMonths() {
            const yearRef = ref(db, `expenses/${currentYear}`);
            const snapshot = await get(yearRef);
            monthSelect.innerHTML = "";
            if (!snapshot.exists()) {
                monthSelect.innerHTML = `<option value="">-- ‡∫ö‡ªç‡ªà‡∫°‡∫µ‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô --</option>`;
                return;
            }
            snapshot.forEach(child => {
                const mm = child.key;
                const opt = document.createElement("option");
                opt.value = mm;
                opt.textContent = `‡ªÄ‡∫î‡∫∑‡∫≠‡∫ô ${mm} / ${currentYear}`;
                monthSelect.appendChild(opt);
            });
            loadMonth();
        }

        window.saveExpense = async function () {
            const date = dateInput.value;
            const item = itemInput.value;
            const price = Number(priceInput.value);

            // ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà alert ‡∏î‡πâ‡∏ß‡∏¢ Custom Alert
            if (!date || !item || !price) {
                showCustomAlert("‡∫Å‡∫∞‚Äã‡∫•‡∫∏‚Äã‡∫ô‡∫≤‚Äã‡∫Å‡∫≠‡∫Å‚Äã‡∫Ç‡ªç‡ªâ‚Äã‡∫°‡∫π‡∫ô‚Äã‡ªÉ‡∫´‡ªâ‚Äã‡∫Ñ‡∫ª‡∫ö");
                return;
            }
            const y = date.split("-")[0];
            const m = date.split("-")[1];

            // 1. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            const newRef = push(ref(db, `expenses/${y}/${m}`));
            await set(newRef, {
                date,
                item,
                price
            });

            // 2. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏´‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
            const todayRef = ref(db, `expenses/${y}/${m}`);
            const snapshot = await get(todayRef);
            let todayTotal = 0;
            const todayStr = dateInput.value;

            if (snapshot.exists()) {
                snapshot.forEach(child => {
                    const data = child.val();
                    if (data.date === todayStr) {
                        todayTotal += Number(data.price);
                    }
                });
            }

            // 3. Post-Save Total Notification
            // ‡πÅ‡∏õ‡∏•‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ (‡πÉ‡∏ä‡πâ lo-LA ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏á‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏ö‡∏ö‡∏•‡∏≤‡∏ß‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏µ‡∏ö)
            const totalTextFormatted = todayTotal.toLocaleString("lo-LA");

            // üî• MODIFIED: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏£‡πâ‡∏≠‡∏á‡∏Ç‡∏≠
            const speechMessage = `‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß. ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÑ‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${totalTextFormatted} ‡∏Å‡∏µ‡∏ö`;

            // ‡πÅ‡∏™‡∏î‡∏á Notification ‡∏ö‡∏ô‡∏à‡∏≠ (‡∏Ñ‡∏á‡∏†‡∏≤‡∏©‡∏≤‡∏•‡∏≤‡∏ß‡∏ï‡∏≤‡∏° UI ‡πÄ‡∏î‡∏¥‡∏°)
            const notificationMsg = `‚úî ‡∫ó‡ªà‡∫≤‡∫ô‡ªÑ‡∫î‡ªâ‡∫ö‡∫±‡∫ô‡∫ó‡∫∂‡∫Å‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô‡∫™‡∫≥‡ªÄ‡∫•‡∫±‡∫î‡ªÅ‡∫•‡ªâ‡∫ß\n‡∫ß‡∫±‡∫ô‡∫ô‡∫µ‡ªâ‡∫ó‡ªà‡∫≤‡∫ô‡ªÉ‡∫ä‡ªâ‡∫à‡ªà‡∫≤‡∫ç‡ªÑ‡∫õ‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î ${totalTextFormatted} ‡∫Å‡∫µ‡∫ö`;
            showNotification(notificationMsg, "save-complete");

            // üî• MODIFIED: ‡∏≠‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
            speakText(speechMessage);

            // 4. ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
            loadAvailableMonths();
            loadMonth();

            // 5. ‡∏•‡πâ‡∏≤‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            itemInput.value = "";
            priceInput.value = "";
        };
        window.loadMonth = function () {
            const m = monthSelect.value;
            const y = currentYear;
            const tableBody = document.getElementById("expenseTable");
            tableBody.innerHTML = "";
            if (!m) return;
            const monthRef = ref(db, `expenses/${y}/${m}`);
            onValue(monthRef, (snapshot) => {
                tableBody.innerHTML = "";
                let index = 1;
                let total = 0;
                let todayTotal = 0;
                const todayStr = document.getElementById("dateInput").value;

                snapshot.forEach(child => {
                    const key = child.key;
                    const data = child.val();
                    total += Number(data.price);
                    if (data.date === todayStr) {
                        todayTotal += Number(data.price);
                    }

                    // ‡πÉ‡∏ä‡πâ toLocaleString("lo-LA") ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏≤‡∏ß
                    tableBody.innerHTML += ` ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬†<tr> ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬†<td>${index++}</td> ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬†<td>${data.date}</td> ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬†<td>${data.item}</td> ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬†<td>${Number(data.price).toLocaleString("lo-LA")}</td>¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† <td><button onclick="openEdit('${y}','${m}','${key}','${data.date}','${data.item}','${data.price}')">‚úè</button></td>¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† <td><button onclick="askDelete('${y}','${m}','${key}')">üóë</button></td> ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬†</tr>`;
                });

                todayTotalText.textContent = "‡∫•‡∫ß‡∫°‡∫ß‡∫±‡∫ô‡∫ô‡∫µ‡ªâ: " + todayTotal.toLocaleString("lo-LA") + " ‡∫Å‡∫µ‡∫ö";
                totalText.textContent = "‡∫•‡∫ß‡∫°‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î: " + total.toLocaleString("lo-LA") + " ‡∫Å‡∫µ‡∫ö";
            });
        };
        /** üî• ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î Popup ‡∏•‡∏ö */
        window.askDelete = function (y, m, key) {
            DELETE_Y = y;
            DELETE_M = m;
            DELETE_KEY = key;
            document.getElementById("deleteConfirmBox").style.display = "flex";
            // üî• MODIFIED: ‡∏≠‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏£‡πâ‡∏≠‡∏á‡∏Ç‡∏≠
            const thaiConfirmation = "‡∏ó‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÑ‡∏´‡∏° ‡∏ñ‡πâ‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏î‡∏•‡∏ö ‡∏ñ‡πâ‡∏≤‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å";
            speakText(thaiConfirmation);
        };
        /** üî• ‡∏Å‡∏î‡∏•‡∏ö‡∏à‡∏£‡∏¥‡∏á */
        window.confirmDelete = function () {
            remove(ref(db, `expenses/${DELETE_Y}/${DELETE_M}/${DELETE_KEY}`)).then(() => {
                document.getElementById("deleteConfirmBox").style.display = "none";
                loadMonth();
                // üî• MODIFIED: ‡∏≠‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏´‡∏•‡∏±‡∏á‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
                speakText("‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß");
            });
        };
        /** ‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å */
        window.cancelDelete = function () {
            document.getElementById("deleteConfirmBox").style.display = "none";
        };
        window.openEdit = function (y, m, key, date, item, price) {
            EDIT_Y = y;
            EDIT_M = m;
            EDIT_KEY = key;
            editDate.value = date;
            editItem.value = item;
            editPrice.value = price;
            document.getElementById("editBox").style.display = "flex";
        };
        window.closeEdit = function () {
            document.getElementById("editBox").style.display = "none";
        };
        window.saveEdit = function () {
            const newDate = editDate.value;
            const newItem = editItem.value;
            const newPrice = Number(editPrice.value);

            // ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà alert ‡∏î‡πâ‡∏ß‡∏¢ Custom Alert
            if (!newDate || !newItem || !newPrice) {
                showCustomAlert("‡∫Å‡∫∞‚Äã‡∫•‡∫∏‚Äã‡∫ô‡∫≤‚Äã‡∫Å‡∫≠‡∫Å‚Äã‡∫Ç‡ªç‡ªâ‚Äã‡∫°‡∫π‡∫ô‚Äã‡ªÉ‡∫´‡ªâ‚Äã‡∫Ñ‡∫ª‡∫ö");
                return;
            }
            update(ref(db, `expenses/${EDIT_Y}/${EDIT_M}/${EDIT_KEY}`), {
                date: newDate,
                item: newItem,
                price: newPrice
            }).then(() => {
                // üî• MODIFIED: ‡∏≠‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
                speakText("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß");
                closeEdit();
                loadMonth();
            });
        };
        window.exportExcel = async function () {
            const m = monthSelect.value;
            const y = currentYear;
            if (!m) {
                // üî• MODIFIED: ‡∏≠‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
                speakText("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô");
                return;
            }
            const monthRef = ref(db, `expenses/${y}/${m}`);
            const snapshot = await get(monthRef);
            if (!snapshot.exists()) {
                // üî• MODIFIED: ‡∏≠‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
                speakText("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ");
                return;
            }
            let data = [
                ["‡∫ß‡∫±‡∫ô‡∫ó‡∫µ", "‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô", "‡∫•‡∫≤‡∫Ñ‡∫≤"]
            ];
            snapshot.forEach(child => {
                const d = child.val();
                data.push([d.date, d.item, d.price]);
            });
            const ws = XLSX.utils.aoa_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Expenses");
            const filename = `expenses_${y}_${m}.xlsx`;
            XLSX.writeFile(wb, filename);

            // üî• MODIFIED: ‡∏≠‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏´‡∏•‡∏±‡∏á Export ‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
            speakText("Export Excel ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß");
        };

        loadAvailableMonths();
    </script>
</body>

</html>
